{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Distributed Tracing Data Models",
  "description": "JSON Schema definitions for distributed tracing integration in go-redis-work-queue",
  "definitions": {
    "TraceContext": {
      "type": "object",
      "title": "W3C Trace Context",
      "description": "W3C Trace Context propagation format for distributed tracing",
      "properties": {
        "traceparent": {
          "type": "string",
          "pattern": "^[0-9a-f]{2}-[0-9a-f]{32}-[0-9a-f]{16}-[0-9a-f]{2}$",
          "description": "W3C Trace Context traceparent header",
          "examples": ["00-4bf92f3577b34da6a3ce929d0e0e4736-00f067aa0ba902b7-01"]
        },
        "tracestate": {
          "type": "string",
          "maxLength": 512,
          "description": "W3C Trace Context tracestate header for vendor-specific data",
          "examples": ["vendorname1=value1,vendorname2=value2"]
        },
        "baggage": {
          "type": "object",
          "description": "OpenTelemetry baggage for context propagation",
          "additionalProperties": {
            "type": "string",
            "maxLength": 256
          },
          "maxProperties": 32
        }
      },
      "required": ["traceparent"],
      "additionalProperties": false
    },
    "SpanAttributes": {
      "type": "object",
      "title": "Span Attributes",
      "description": "Standard and custom attributes attached to spans",
      "properties": {
        "queue.system": {
          "type": "string",
          "const": "redis",
          "description": "Queue system identifier"
        },
        "queue.name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 256,
          "description": "Queue name or identifier"
        },
        "queue.operation.type": {
          "type": "string",
          "enum": ["enqueue", "dequeue", "peek", "delete", "update"],
          "description": "Type of queue operation"
        },
        "queue.message.id": {
          "type": "string",
          "description": "Unique message/job identifier"
        },
        "queue.message.priority": {
          "type": "integer",
          "minimum": 0,
          "maximum": 10,
          "description": "Message priority level"
        },
        "queue.message.tenant": {
          "type": "string",
          "description": "Tenant identifier for multi-tenant systems"
        },
        "queue.message.idempotency_key": {
          "type": "string",
          "description": "Idempotency key for duplicate prevention"
        },
        "queue.wait_time_ms": {
          "type": "number",
          "minimum": 0,
          "description": "Time spent waiting in queue (milliseconds)"
        },
        "queue.depth": {
          "type": "integer",
          "minimum": 0,
          "description": "Queue depth at operation time"
        },
        "job.id": {
          "type": "string",
          "description": "Job identifier"
        },
        "job.type": {
          "type": "string",
          "description": "Job type or handler name"
        },
        "job.retry_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Current retry attempt number"
        },
        "job.max_retries": {
          "type": "integer",
          "minimum": 0,
          "description": "Maximum configured retries"
        },
        "job.status": {
          "type": "string",
          "enum": ["success", "failure", "retry", "dead_letter", "timeout"],
          "description": "Job execution status"
        },
        "job.error": {
          "type": "string",
          "maxLength": 1024,
          "description": "Error message if job failed"
        },
        "job.error.type": {
          "type": "string",
          "description": "Error type or class name"
        },
        "job.duration_ms": {
          "type": "number",
          "minimum": 0,
          "description": "Job processing duration (milliseconds)"
        },
        "service.name": {
          "type": "string",
          "description": "Service name"
        },
        "service.version": {
          "type": "string",
          "description": "Service version"
        },
        "service.instance.id": {
          "type": "string",
          "description": "Service instance identifier"
        }
      },
      "additionalProperties": {
        "type": ["string", "number", "boolean", "array"],
        "description": "Custom attributes"
      }
    },
    "SpanEvent": {
      "type": "object",
      "title": "Span Event",
      "description": "Event occurring during span execution",
      "properties": {
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "Event timestamp (ISO 8601)"
        },
        "name": {
          "type": "string",
          "enum": [
            "job.retry",
            "job.dead_letter",
            "job.timeout",
            "queue.throttled",
            "queue.paused",
            "queue.resumed",
            "worker.shutdown",
            "worker.started",
            "error.occurred",
            "checkpoint.reached"
          ],
          "description": "Event name"
        },
        "attributes": {
          "type": "object",
          "description": "Event-specific attributes",
          "additionalProperties": true
        },
        "droppedAttributesCount": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of attributes dropped due to limits"
        }
      },
      "required": ["timestamp", "name"],
      "additionalProperties": false
    },
    "SpanLink": {
      "type": "object",
      "title": "Span Link",
      "description": "Link to another span in the same or different trace",
      "properties": {
        "traceId": {
          "type": "string",
          "pattern": "^[0-9a-f]{32}$",
          "description": "Linked trace ID (hex)"
        },
        "spanId": {
          "type": "string",
          "pattern": "^[0-9a-f]{16}$",
          "description": "Linked span ID (hex)"
        },
        "traceState": {
          "type": "string",
          "description": "W3C tracestate from linked span"
        },
        "attributes": {
          "type": "object",
          "description": "Link attributes",
          "additionalProperties": true
        },
        "droppedAttributesCount": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of attributes dropped due to limits"
        }
      },
      "required": ["traceId", "spanId"],
      "additionalProperties": false
    },
    "Span": {
      "type": "object",
      "title": "Span",
      "description": "Complete span data structure",
      "properties": {
        "traceId": {
          "type": "string",
          "pattern": "^[0-9a-f]{32}$",
          "description": "Trace ID (hex)"
        },
        "spanId": {
          "type": "string",
          "pattern": "^[0-9a-f]{16}$",
          "description": "Span ID (hex)"
        },
        "parentSpanId": {
          "type": "string",
          "pattern": "^[0-9a-f]{16}$",
          "description": "Parent span ID (hex)"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 256,
          "description": "Span name/operation"
        },
        "kind": {
          "type": "string",
          "enum": ["INTERNAL", "SERVER", "CLIENT", "PRODUCER", "CONSUMER"],
          "description": "Span kind"
        },
        "startTime": {
          "type": "string",
          "format": "date-time",
          "description": "Start timestamp (ISO 8601)"
        },
        "endTime": {
          "type": "string",
          "format": "date-time",
          "description": "End timestamp (ISO 8601)"
        },
        "duration": {
          "type": "integer",
          "minimum": 0,
          "description": "Duration in microseconds"
        },
        "status": {
          "$ref": "#/definitions/SpanStatus"
        },
        "attributes": {
          "$ref": "#/definitions/SpanAttributes"
        },
        "events": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/SpanEvent"
          },
          "maxItems": 128,
          "description": "Span events"
        },
        "links": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/SpanLink"
          },
          "maxItems": 128,
          "description": "Links to other spans"
        },
        "resource": {
          "$ref": "#/definitions/Resource"
        },
        "droppedAttributesCount": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of attributes dropped"
        },
        "droppedEventsCount": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of events dropped"
        },
        "droppedLinksCount": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of links dropped"
        }
      },
      "required": ["traceId", "spanId", "name", "startTime", "endTime"],
      "additionalProperties": false
    },
    "SpanStatus": {
      "type": "object",
      "title": "Span Status",
      "description": "Status of span execution",
      "properties": {
        "code": {
          "type": "string",
          "enum": ["UNSET", "OK", "ERROR"],
          "description": "Status code"
        },
        "message": {
          "type": "string",
          "maxLength": 512,
          "description": "Status message"
        }
      },
      "required": ["code"],
      "additionalProperties": false
    },
    "Resource": {
      "type": "object",
      "title": "Resource",
      "description": "Resource information for the span source",
      "properties": {
        "attributes": {
          "type": "object",
          "properties": {
            "service.name": {
              "type": "string",
              "description": "Service name"
            },
            "service.version": {
              "type": "string",
              "description": "Service version"
            },
            "service.instance.id": {
              "type": "string",
              "description": "Service instance ID"
            },
            "host.name": {
              "type": "string",
              "description": "Hostname"
            },
            "process.pid": {
              "type": "integer",
              "description": "Process ID"
            },
            "telemetry.sdk.name": {
              "type": "string",
              "description": "SDK name"
            },
            "telemetry.sdk.language": {
              "type": "string",
              "description": "SDK language"
            },
            "telemetry.sdk.version": {
              "type": "string",
              "description": "SDK version"
            }
          },
          "additionalProperties": true
        },
        "droppedAttributesCount": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of dropped attributes"
        }
      },
      "required": ["attributes"],
      "additionalProperties": false
    },
    "JobMetadata": {
      "type": "object",
      "title": "Job Metadata with Tracing",
      "description": "Job metadata including trace context",
      "properties": {
        "id": {
          "type": "string",
          "description": "Job ID"
        },
        "type": {
          "type": "string",
          "description": "Job type"
        },
        "priority": {
          "type": "integer",
          "minimum": 0,
          "maximum": 10
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        },
        "scheduledFor": {
          "type": "string",
          "format": "date-time"
        },
        "retryCount": {
          "type": "integer",
          "minimum": 0
        },
        "maxRetries": {
          "type": "integer",
          "minimum": 0
        },
        "timeout": {
          "type": "integer",
          "description": "Timeout in seconds"
        },
        "traceContext": {
          "$ref": "#/definitions/TraceContext"
        },
        "customAttributes": {
          "type": "object",
          "additionalProperties": true
        }
      },
      "required": ["id", "type"],
      "additionalProperties": false
    },
    "TracingConfig": {
      "type": "object",
      "title": "Tracing Configuration",
      "description": "Complete tracing system configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": false,
          "description": "Enable/disable tracing"
        },
        "serviceName": {
          "type": "string",
          "minLength": 1,
          "maxLength": 256,
          "description": "Service name for traces"
        },
        "serviceVersion": {
          "type": "string",
          "description": "Service version"
        },
        "endpoint": {
          "type": "string",
          "format": "uri",
          "description": "OTLP endpoint URL"
        },
        "headers": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Headers for OTLP requests"
        },
        "insecure": {
          "type": "boolean",
          "default": false,
          "description": "Use insecure connection"
        },
        "compression": {
          "type": "string",
          "enum": ["none", "gzip"],
          "default": "none",
          "description": "Compression method"
        },
        "timeout": {
          "type": "integer",
          "minimum": 1000,
          "maximum": 60000,
          "default": 10000,
          "description": "Export timeout in milliseconds"
        },
        "sampling": {
          "$ref": "#/definitions/SamplingConfig"
        },
        "attributeFilter": {
          "$ref": "#/definitions/AttributeFilter"
        },
        "propagators": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["tracecontext", "baggage", "b3", "b3multi", "jaeger", "xray"]
          },
          "default": ["tracecontext", "baggage"],
          "description": "Propagators to use"
        },
        "resourceAttributes": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Additional resource attributes"
        }
      },
      "required": ["enabled", "serviceName"],
      "additionalProperties": false
    },
    "SamplingConfig": {
      "type": "object",
      "title": "Sampling Configuration",
      "description": "Configuration for trace sampling",
      "properties": {
        "strategy": {
          "type": "string",
          "enum": ["always_on", "always_off", "trace_id_ratio", "parent_based", "custom"],
          "default": "parent_based",
          "description": "Sampling strategy"
        },
        "defaultRate": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 0.1,
          "description": "Default sampling rate"
        },
        "queueRates": {
          "type": "object",
          "additionalProperties": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          },
          "description": "Per-queue sampling rates"
        },
        "operationRates": {
          "type": "object",
          "additionalProperties": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          },
          "description": "Per-operation sampling rates"
        },
        "prioritySampling": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "thresholds": {
              "type": "object",
              "additionalProperties": {
                "type": "number",
                "minimum": 0,
                "maximum": 1
              }
            }
          },
          "description": "Priority-based sampling"
        },
        "tailSampling": {
          "$ref": "#/definitions/TailSamplingConfig"
        }
      },
      "additionalProperties": false
    },
    "TailSamplingConfig": {
      "type": "object",
      "title": "Tail Sampling Configuration",
      "description": "Configuration for tail-based sampling",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": false,
          "description": "Enable tail sampling"
        },
        "decisionWait": {
          "type": "integer",
          "minimum": 1000,
          "maximum": 60000,
          "default": 30000,
          "description": "Wait time before decision (ms)"
        },
        "policies": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/TailSamplingPolicy"
          },
          "description": "Sampling policies"
        }
      },
      "additionalProperties": false
    },
    "TailSamplingPolicy": {
      "type": "object",
      "title": "Tail Sampling Policy",
      "description": "Individual tail sampling policy",
      "properties": {
        "name": {
          "type": "string",
          "description": "Policy name"
        },
        "type": {
          "type": "string",
          "enum": ["error", "latency", "always_sample", "string_attribute", "numeric_attribute"],
          "description": "Policy type"
        },
        "config": {
          "type": "object",
          "properties": {
            "samplingRate": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            },
            "thresholdMs": {
              "type": "integer",
              "minimum": 0
            },
            "attributeKey": {
              "type": "string"
            },
            "attributeValue": {
              "type": ["string", "number"]
            }
          },
          "additionalProperties": true
        }
      },
      "required": ["name", "type"],
      "additionalProperties": false
    },
    "AttributeFilter": {
      "type": "object",
      "title": "Attribute Filter Configuration",
      "description": "Configuration for filtering span attributes",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable attribute filtering"
        },
        "mode": {
          "type": "string",
          "enum": ["allowlist", "denylist"],
          "default": "allowlist",
          "description": "Filter mode"
        },
        "attributes": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Attribute names to allow/deny"
        },
        "patterns": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Regex patterns for attributes"
        },
        "redaction": {
          "$ref": "#/definitions/RedactionConfig"
        },
        "limits": {
          "type": "object",
          "properties": {
            "maxAttributeLength": {
              "type": "integer",
              "minimum": 1,
              "default": 1024
            },
            "maxAttributeCount": {
              "type": "integer",
              "minimum": 1,
              "default": 128
            }
          }
        }
      },
      "additionalProperties": false
    },
    "RedactionConfig": {
      "type": "object",
      "title": "PII Redaction Configuration",
      "description": "Configuration for redacting sensitive information",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable PII redaction"
        },
        "patterns": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "description": "Pattern name"
              },
              "regex": {
                "type": "string",
                "description": "Regex pattern"
              },
              "replacement": {
                "type": "string",
                "default": "[REDACTED]",
                "description": "Replacement text"
              }
            },
            "required": ["name", "regex"]
          },
          "description": "Redaction patterns"
        },
        "builtinPatterns": {
          "type": "object",
          "properties": {
            "email": {
              "type": "boolean",
              "default": true
            },
            "ipAddress": {
              "type": "boolean",
              "default": true
            },
            "creditCard": {
              "type": "boolean",
              "default": true
            },
            "ssn": {
              "type": "boolean",
              "default": true
            },
            "phoneNumber": {
              "type": "boolean",
              "default": true
            }
          },
          "description": "Enable built-in patterns"
        }
      },
      "additionalProperties": false
    },
    "ExportMetrics": {
      "type": "object",
      "title": "Export Metrics",
      "description": "Metrics about span export performance",
      "properties": {
        "timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "period": {
          "type": "string",
          "description": "Metrics period (e.g., 1h, 24h)"
        },
        "exports": {
          "type": "object",
          "properties": {
            "successful": {
              "type": "integer",
              "minimum": 0
            },
            "failed": {
              "type": "integer",
              "minimum": 0
            },
            "total": {
              "type": "integer",
              "minimum": 0
            }
          }
        },
        "spans": {
          "type": "object",
          "properties": {
            "exported": {
              "type": "integer",
              "minimum": 0
            },
            "dropped": {
              "type": "integer",
              "minimum": 0
            },
            "queued": {
              "type": "integer",
              "minimum": 0
            }
          }
        },
        "latency": {
          "type": "object",
          "properties": {
            "min": {
              "type": "number",
              "minimum": 0
            },
            "max": {
              "type": "number",
              "minimum": 0
            },
            "avg": {
              "type": "number",
              "minimum": 0
            },
            "p50": {
              "type": "number",
              "minimum": 0
            },
            "p95": {
              "type": "number",
              "minimum": 0
            },
            "p99": {
              "type": "number",
              "minimum": 0
            }
          },
          "description": "Export latency in milliseconds"
        },
        "batchSize": {
          "type": "object",
          "properties": {
            "min": {
              "type": "integer",
              "minimum": 1
            },
            "max": {
              "type": "integer",
              "minimum": 1
            },
            "avg": {
              "type": "number",
              "minimum": 1
            }
          }
        },
        "throughput": {
          "type": "number",
          "minimum": 0,
          "description": "Spans per second"
        }
      },
      "required": ["timestamp", "period"],
      "additionalProperties": false
    }
  }
}