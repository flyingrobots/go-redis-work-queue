{
  "task_id": "P1.T019",
  "created_at": "2025-09-14T19:41:47.128348Z",
  "task": {
    "id": "P1.T019",
    "feature_id": "F007",
    "title": "Design Exactly Once Patterns",
    "description": "Design task for Exactly Once Patterns",
    "boundaries": {
      "expected_complexity": {
        "value": "1 design doc, ~800-1200 lines",
        "breakdown": "Architecture (400), API spec (300), Data model (200), Diagrams (300)"
      },
      "definition_of_done": {
        "criteria": [
          "Architecture documented with Mermaid diagrams",
          "API endpoints specified in OpenAPI 3.0 format",
          "Data models defined with JSON Schema",
          "Integration points identified and documented",
          "Security threat model completed",
          "Performance requirements specified",
          "Testing strategy defined"
        ],
        "stop_when": "Design approved by architect; do NOT start implementation"
      },
      "scope": {
        "includes": [
          "docs/design/f007-design.md",
          "docs/api/f007-openapi.yaml",
          "docs/schemas/f007-schema.json"
        ],
        "excludes": [
          "implementation code",
          "tests",
          "deployment configs"
        ],
        "restrictions": "Must follow company design template"
      }
    },
    "execution_guidance": {
      "logging": {
        "format": "JSON Lines (JSONL)",
        "required_fields": [
          "timestamp",
          "task_id",
          "step",
          "status",
          "message"
        ],
        "optional_fields": [
          "percent",
          "data",
          "checkpoint"
        ],
        "status_values": [
          "start",
          "progress",
          "done",
          "error",
          "checkpoint"
        ]
      },
      "checkpoints": [
        {
          "id": "cp1",
          "at_percent": 25,
          "description": "Architecture draft complete"
        },
        {
          "id": "cp2",
          "at_percent": 50,
          "description": "API specification complete"
        },
        {
          "id": "cp3",
          "at_percent": 75,
          "description": "Data models and diagrams complete"
        },
        {
          "id": "cp4",
          "at_percent": 100,
          "description": "Review and approval"
        }
      ],
      "monitoring": {
        "metrics_to_track": [],
        "alerts": []
      }
    },
    "resource_requirements": {
      "estimated": {
        "cpu_cores": 1,
        "memory_mb": 512,
        "disk_io_mbps": 10
      },
      "peak": {
        "cpu_cores": 2,
        "memory_mb": 1024,
        "disk_io_mbps": 50,
        "during": "compilation or testing"
      },
      "worker_capabilities_required": [
        "documentation",
        "architecture",
        "api_design"
      ]
    },
    "scheduling_hints": {
      "priority": "high",
      "preemptible": false,
      "retry_on_failure": true,
      "max_retries": 3,
      "checkpoint_capable": true
    },
    "duration": {
      "optimistic": 4,
      "mostLikely": 8,
      "pessimistic": 16
    },
    "shared_resources": {
      "exclusive_locks": [],
      "shared_limited": [],
      "creates": [],
      "modifies": []
    },
    "acceptance_checks": [
      {
        "type": "automated",
        "description": "Idempotency helpers and dedup storage shipped with metrics.",
        "script": "test_p1.t019.sh"
      },
      {
        "type": "automated",
        "description": "Optional outbox relay with sample integrations.",
        "script": "test_p1.t019.sh"
      },
      {
        "type": "automated",
        "description": "Documentation of tradeoffs and failure modes.",
        "script": "test_p1.t019.sh"
      },
      {
        "type": "manual",
        "description": "Idempotency key helper + storage",
        "script": null
      },
      {
        "type": "manual",
        "description": "Metrics + Admin API for dedup stats",
        "script": null
      }
    ],
    "evidence": [
      {
        "type": "plan",
        "source": "docs/ideas/exactly-once-patterns.md",
        "excerpt": "Document and optionally enforce patterns for effectively exactly\u2011once processing: idempotency keys, deduplication sets, and the transactional outbox. Provide helpers and guardrails so teams can adopt ",
        "confidence": 1.0,
        "rationale": "Primary feature specification"
      }
    ],
    "implementation_spec": {
      "design_sections": [
        "Executive Summary",
        "System Architecture",
        "API Specification",
        "Data Models",
        "Security Model",
        "Performance Requirements",
        "Testing Strategy",
        "Deployment Plan"
      ],
      "deliverables": [
        "Architecture document (Markdown + Mermaid)",
        "OpenAPI 3.0 specification",
        "JSON Schema definitions",
        "Security threat model",
        "Performance benchmarks"
      ],
      "technical_approach": [
        "Idempotency keys:",
        "Producer attaches `id` per job; worker records `id` in a dedup set/hash with TTL.",
        "Before side effects, perform `SETNX`/`HSETNX` style guard; on success, proceed; else skip.",
        "Dedup store:",
        "Redis SET/HASH keyed by queue/tenant; TTL for practical bounds; cardinality metrics.",
        "Outbox pattern:",
        "Provide library hooks to write DB changes + outbox event in one transaction.",
        "Separate relay publishes from outbox to queue; worker idempotency still checked.",
        "Helpers:",
        "Go utilities for idempotency check/update and outbox relay; Admin API to inspect dedup stats.",
        "TUI:",
        "Info panel: idempotency hit rate; dedup size; recent duplicates avoided."
      ],
      "user_stories": [
        "I can mark jobs with an idempotency key and rely on helpers to avoid duplicate processing.",
        "I can see dedup rates and size to tune TTLs."
      ]
    }
  },
  "dependencies": [],
  "instructions": {
    "on_complete": "Move this file to finished-tasks/P1.T019.json",
    "on_failure": "Move this file to failed-tasks/P1.T019.json",
    "on_help_needed": "Move to help-me/P1.T019.json",
    "note": "READ THE FULL TASK SPECIFICATION! All details are in the task field.",
    "resource_locks": {
      "exclusive_locks": [],
      "shared_limited": [],
      "creates": [],
      "modifies": []
    }
  }
}