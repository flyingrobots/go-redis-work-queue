{
  "task_id": "P1.T020",
  "created_at": "2025-09-14T19:41:47.128565Z",
  "task": {
    "id": "P1.T020",
    "feature_id": "F007",
    "title": "Implement Exactly Once Patterns",
    "description": "Implement task for Exactly Once Patterns",
    "boundaries": {
      "expected_complexity": {
        "value": "~ LoC",
        "breakdown": "Core logic (60%), Tests (25%), Integration (15%)"
      },
      "definition_of_done": {
        "criteria": [
          "All functions implemented per specification",
          "Unit tests passing with 80% coverage",
          "Integration tests passing",
          "Code reviewed and approved",
          "Documentation updated",
          "No linting errors",
          "Performance benchmarks met",
          "Idempotency helpers and dedup storage shipped with metrics.",
          "Optional outbox relay with sample integrations.",
          "Documentation of tradeoffs and failure modes."
        ],
        "stop_when": "Core functionality complete; do NOT add extra features"
      },
      "scope": {
        "includes": [
          "internal/exactly-once-patterns/",
          "internal/exactly-once-patterns/*_test.go",
          "docs/api/exactly-once-patterns.md"
        ],
        "excludes": [
          "UI unless specified",
          "deployment configs"
        ],
        "restrictions": "Follow existing code patterns and style guide"
      }
    },
    "execution_guidance": {
      "logging": {
        "format": "JSON Lines (JSONL)",
        "required_fields": [
          "timestamp",
          "task_id",
          "step",
          "status",
          "message"
        ],
        "optional_fields": [
          "percent",
          "data",
          "checkpoint"
        ],
        "status_values": [
          "start",
          "progress",
          "done",
          "error",
          "checkpoint"
        ]
      },
      "checkpoints": [
        {
          "id": "setup",
          "at_percent": 10,
          "description": "Module structure created"
        },
        {
          "id": "core",
          "at_percent": 40,
          "description": "Core logic implemented"
        },
        {
          "id": "integration",
          "at_percent": 60,
          "description": "Integration complete"
        },
        {
          "id": "tests",
          "at_percent": 80,
          "description": "Tests passing"
        },
        {
          "id": "docs",
          "at_percent": 100,
          "description": "Documentation complete"
        }
      ],
      "monitoring": {
        "metrics_to_track": [],
        "alerts": []
      }
    },
    "resource_requirements": {
      "estimated": {
        "cpu_cores": 1,
        "memory_mb": 1024,
        "disk_io_mbps": 10
      },
      "peak": {
        "cpu_cores": 2,
        "memory_mb": 2048,
        "disk_io_mbps": 50,
        "during": "compilation or testing"
      },
      "worker_capabilities_required": [
        "golang",
        "backend",
        "redis"
      ]
    },
    "scheduling_hints": {
      "priority": "high",
      "preemptible": false,
      "retry_on_failure": true,
      "max_retries": 3,
      "checkpoint_capable": true
    },
    "duration": {
      "optimistic": 8,
      "mostLikely": 16,
      "pessimistic": 24
    },
    "shared_resources": {
      "exclusive_locks": [],
      "shared_limited": [
        {
          "resource": "test_redis",
          "quantity": 1
        }
      ],
      "creates": [],
      "modifies": []
    },
    "acceptance_checks": [
      {
        "type": "automated",
        "description": "Idempotency helpers and dedup storage shipped with metrics.",
        "script": "test_p1.t020.sh"
      },
      {
        "type": "automated",
        "description": "Optional outbox relay with sample integrations.",
        "script": "test_p1.t020.sh"
      },
      {
        "type": "automated",
        "description": "Documentation of tradeoffs and failure modes.",
        "script": "test_p1.t020.sh"
      },
      {
        "type": "manual",
        "description": "Idempotency key helper + storage",
        "script": null
      },
      {
        "type": "manual",
        "description": "Metrics + Admin API for dedup stats",
        "script": null
      }
    ],
    "evidence": [
      {
        "type": "plan",
        "source": "docs/ideas/exactly-once-patterns.md",
        "excerpt": "Document and optionally enforce patterns for effectively exactly\u2011once processing: idempotency keys, deduplication sets, and the transactional outbox. Provide helpers and guardrails so teams can adopt ",
        "confidence": 1.0,
        "rationale": "Primary feature specification"
      }
    ],
    "implementation_spec": {
      "implementation_checklist": [
        "Idempotency key helper + storage",
        "Metrics + Admin API for dedup stats",
        "Outbox relay library + example",
        "Docs + tuning guide"
      ],
      "technical_approach": [
        "Idempotency keys:",
        "Producer attaches `id` per job; worker records `id` in a dedup set/hash with TTL.",
        "Before side effects, perform `SETNX`/`HSETNX` style guard; on success, proceed; else skip.",
        "Dedup store:",
        "Redis SET/HASH keyed by queue/tenant; TTL for practical bounds; cardinality metrics.",
        "Outbox pattern:",
        "Provide library hooks to write DB changes + outbox event in one transaction.",
        "Separate relay publishes from outbox to queue; worker idempotency still checked.",
        "Helpers:",
        "Go utilities for idempotency check/update and outbox relay; Admin API to inspect dedup stats.",
        "TUI:",
        "Info panel: idempotency hit rate; dedup size; recent duplicates avoided."
      ],
      "code_structure": {
        "main_package": "internal/exactly-once-patterns",
        "files": [
          "exactly-once-patterns.go - Main implementation",
          "types.go - Data structures",
          "handlers.go - Request handlers",
          "errors.go - Custom errors",
          "config.go - Configuration"
        ]
      }
    }
  },
  "dependencies": [],
  "instructions": {
    "on_complete": "Move this file to finished-tasks/P1.T020.json",
    "on_failure": "Move this file to failed-tasks/P1.T020.json",
    "on_help_needed": "Move to help-me/P1.T020.json",
    "note": "READ THE FULL TASK SPECIFICATION! All details are in the task field.",
    "resource_locks": {
      "exclusive_locks": [],
      "shared_limited": [
        {
          "resource": "test_redis",
          "quantity": 1
        }
      ],
      "creates": [],
      "modifies": []
    }
  }
}