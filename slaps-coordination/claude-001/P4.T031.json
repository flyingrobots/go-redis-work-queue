{
  "task_id": "P4.T031",
  "created_at": "2025-09-14T19:41:47.130953Z",
  "task": {
    "id": "P4.T031",
    "feature_id": "F011",
    "title": "Design Automatic Capacity Planning",
    "description": "Design task for Automatic Capacity Planning",
    "boundaries": {
      "expected_complexity": {
        "value": "1 design doc, ~800-1200 lines",
        "breakdown": "Architecture (400), API spec (300), Data model (200), Diagrams (300)"
      },
      "definition_of_done": {
        "criteria": [
          "Architecture documented with Mermaid diagrams",
          "API endpoints specified in OpenAPI 3.0 format",
          "Data models defined with JSON Schema",
          "Integration points identified and documented",
          "Security threat model completed",
          "Performance requirements specified",
          "Testing strategy defined"
        ],
        "stop_when": "Design approved by architect; do NOT start implementation"
      },
      "scope": {
        "includes": [
          "docs/design/f011-design.md",
          "docs/api/f011-openapi.yaml",
          "docs/schemas/f011-schema.json"
        ],
        "excludes": [
          "implementation code",
          "tests",
          "deployment configs"
        ],
        "restrictions": "Must follow company design template"
      }
    },
    "execution_guidance": {
      "logging": {
        "format": "JSON Lines (JSONL)",
        "required_fields": [
          "timestamp",
          "task_id",
          "step",
          "status",
          "message"
        ],
        "optional_fields": [
          "percent",
          "data",
          "checkpoint"
        ],
        "status_values": [
          "start",
          "progress",
          "done",
          "error",
          "checkpoint"
        ]
      },
      "checkpoints": [
        {
          "id": "cp1",
          "at_percent": 25,
          "description": "Architecture draft complete"
        },
        {
          "id": "cp2",
          "at_percent": 50,
          "description": "API specification complete"
        },
        {
          "id": "cp3",
          "at_percent": 75,
          "description": "Data models and diagrams complete"
        },
        {
          "id": "cp4",
          "at_percent": 100,
          "description": "Review and approval"
        }
      ],
      "monitoring": {
        "metrics_to_track": [],
        "alerts": []
      }
    },
    "resource_requirements": {
      "estimated": {
        "cpu_cores": 1,
        "memory_mb": 512,
        "disk_io_mbps": 10
      },
      "peak": {
        "cpu_cores": 2,
        "memory_mb": 1024,
        "disk_io_mbps": 50,
        "during": "compilation or testing"
      },
      "worker_capabilities_required": [
        "documentation",
        "architecture",
        "api_design"
      ]
    },
    "scheduling_hints": {
      "priority": "medium",
      "preemptible": true,
      "retry_on_failure": true,
      "max_retries": 3,
      "checkpoint_capable": true
    },
    "duration": {
      "optimistic": 4,
      "mostLikely": 8,
      "pessimistic": 16
    },
    "shared_resources": {
      "exclusive_locks": [],
      "shared_limited": [],
      "creates": [],
      "modifies": []
    },
    "acceptance_checks": [
      {
        "type": "automated",
        "description": "Planner computes recommended replicas from \u03bb and service times under a chosen SLO.",
        "script": "test_p4.t031.sh"
      },
      {
        "type": "automated",
        "description": "Cool\u2011down and cap logic avoids oscillation.",
        "script": "test_p4.t031.sh"
      },
      {
        "type": "automated",
        "description": "TUI previews impact and supports manual apply.",
        "script": "test_p4.t031.sh"
      },
      {
        "type": "manual",
        "description": "Compute \u03bb and service stats by queue",
        "script": null
      },
      {
        "type": "manual",
        "description": "Implement planner + safety logic",
        "script": null
      }
    ],
    "evidence": [
      {
        "type": "plan",
        "source": "docs/ideas/automatic-capacity-planning.md",
        "excerpt": "Predict and set recommended worker counts to meet SLOs based on historical arrival/service rates. Generate actionable plans (or auto\u2011apply via Operator) with safety bands, cool\u2011downs, and what\u2011if simu",
        "confidence": 1.0,
        "rationale": "Primary feature specification"
      }
    ],
    "implementation_spec": {
      "design_sections": [
        "Executive Summary",
        "System Architecture",
        "API Specification",
        "Data Models",
        "Security Model",
        "Performance Requirements",
        "Testing Strategy",
        "Deployment Plan"
      ],
      "deliverables": [
        "Architecture document (Markdown + Mermaid)",
        "OpenAPI 3.0 specification",
        "JSON Schema definitions",
        "Security threat model",
        "Performance benchmarks"
      ],
      "technical_approach": [
        "Inputs:",
        "Arrival rate \u03bb(t) from enqueue metrics; service time distribution for jobs (mean, p95); current concurrency and utilization.",
        "SLO targets (p95 latency, max backlog, drain time after burst).",
        "Model:",
        "Use queueing approximations (M/M/c or M/G/c) to estimate needed concurrency `c` for target SLO.",
        "Blend with recent forecasts (EWMA/Holt\u2011Winters) to project \u03bb over next 30\u2013120 minutes.",
        "Add safety margin (e.g., 10\u201320%) and apply min/max caps.",
        "Planner:",
        "Produce a time\u2011segmented plan: desired replicas per WorkerPool per window.",
        "Add cool\u2011downs and step size limits to prevent thrash; roll forward only when confidence > threshold.",
        "Application:",
        "Manual mode: show plan in TUI with \u201cApply\u201d button.",
        "Auto mode: write desired replicas via Kubernetes Operator or local scaler.",
        "TUI:",
        "Planner panel with \u201cwhat\u2011if\u201d sliders (SLO, margin) and preview overlays on charts.",
        "Show expected backlog/latency under the proposed plan."
      ],
      "user_stories": [
        "I can see and apply a capacity plan that meets a p95 latency SLO.",
        "I can enable auto\u2011apply with caps and cooldowns."
      ]
    }
  },
  "dependencies": [],
  "instructions": {
    "on_complete": "Move this file to finished-tasks/P4.T031.json",
    "on_failure": "Move this file to failed-tasks/P4.T031.json",
    "on_help_needed": "Move to help-me/P4.T031.json",
    "note": "READ THE FULL TASK SPECIFICATION! All details are in the task field.",
    "resource_locks": {
      "exclusive_locks": [],
      "shared_limited": [],
      "creates": [],
      "modifies": []
    }
  }
}